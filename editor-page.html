<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />

		<title>Code Editor | UICrate</title>
		<!-- CodeMirror CSS -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/codemirror.min.css" />
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/theme/material-darker.min.css"
		/>
		<link rel="stylesheet" href="editor-page.css" />
	</head>
	<body>
		<header>
			<a href="index.html" class="navSection" id="header-logo">
				<svg
					fill="#f8fafc"
					height="30px"
					width="30px"
					version="1.1"
					id="Capa_1"
					xmlns="http://www.w3.org/2000/svg"
					xmlns:xlink="http://www.w3.org/1999/xlink"
					viewBox="0 0 60 60"
					xml:space="preserve"
				>
					<g id="SVGRepo_bgCarrier" stroke-width="0"></g>
					<g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
					<g id="SVGRepo_iconCarrier">
						<g>
							<path
								d="M12,0h-2H0v48v2v10h48h2h10V12v-2V0H12z M48,39.045L39.045,48H30.56L48,30.56V39.045z M48,41.873V48h-6.127L48,41.873z M27.731,48h-8.485L48,19.246v8.485L27.731,48z M48,16.418L16.418,48H12v-4.067L43.932,12H48V16.418z M12,41.104v-8.485L32.619,12 h8.485L12,41.104z M12,29.791v-8.486L21.305,12h8.486L12,29.791z M12,18.477V12h6.477L12,18.477z M2,2h8v10v8.477v14.143v8.485V48 H2V2z M48,58H2v-8h8h2h5.246h8.485h14.142H48V58z M58,58h-8V48v-8.127V25.731v-8.485V12h8V58z M50,10h-2h-4.896h-8.485H20.477H12V2 h46v8H50z"
							></path>
							<circle cx="55" cy="4" r="1"></circle>
							<circle cx="51" cy="4" r="1"></circle>
							<circle cx="55" cy="8" r="1"></circle>
							<circle cx="51" cy="8" r="1"></circle>
							<circle cx="56" cy="55" r="1"></circle>
							<circle cx="56" cy="51" r="1"></circle>
							<circle cx="52" cy="55" r="1"></circle>
							<circle cx="52" cy="51" r="1"></circle>
							<circle cx="5" cy="56" r="1"></circle>
							<circle cx="9" cy="56" r="1"></circle>
							<circle cx="5" cy="52" r="1"></circle>
							<circle cx="9" cy="52" r="1"></circle>
							<circle cx="4" cy="5" r="1"></circle>
							<circle cx="4" cy="9" r="1"></circle>
							<circle cx="8" cy="5" r="1"></circle>
							<circle cx="8" cy="9" r="1"></circle>
						</g>
					</g>
				</svg>
				<h2 class="navItem">UICrate</h2>
			</a>
			<nav class="navbar">
				<div class="navSection" id="navCategory">
					<a href="index.html" class="navItem">Components</a>
					<a href="#" class="navItem">Web Templates</a>
					<a href="#" class="navItem">Blog</a>
				</div>
			</nav>

			<nav class="mobile-nav">
				<div class="mobile-nav-section">
					<a href="index.html" class="mobile-nav-item">Components</a>
					<a href="#" class="mobile-nav-item">Web Templates</a>
					<a href="#" class="mobile-nav-item">Blog</a>
				</div>
			</nav>
			<button class="toggle-btn" id="toggleBtn">
				<div class="hamburger">
					<div class="bar"></div>
					<div class="bar"></div>
					<div class="bar"></div>
				</div>
			</button>
		</header>
		<div id="circle"></div>
		<section class="container" id="split-container">
			<div class="editor-container" id="editor-container">
				<div id="editor-sections">
					<div class="editor-section active" id="html-section">
						<div class="editor-header">
							<div class="arrow-icon">
								<i class="fa-solid fa-chevron-down"></i>
							</div>
							<h5 onclick="toggleSection('html-editor')">HTML</h5>
							<button class="copy-btn" onclick="copyToClipboard('html-editor')">
								<span>Copy </span><i class="fa-regular fa-clipboard"></i>
							</button>
						</div>
						<div id="html-editor" class="code-editor"></div>
					</div>
					<div class="editor-section" id="css-section">
						<div class="editor-header">
							<div class="arrow-icon">
								<i class="fa-solid fa-chevron-down"></i>
							</div>
							<h5 onclick="toggleSection('css-editor')">CSS</h5>
							<button class="copy-btn" onclick="copyToClipboard('css-editor')">
								<span>Copy </span><i class="fa-regular fa-clipboard"></i>
							</button>
						</div>
						<div id="css-editor" class="code-editor"></div>
					</div>
					<div class="editor-section active" id="js-section">
						<div class="editor-header">
							<div class="arrow-icon">
								<i class="fa-solid fa-chevron-down"></i>
							</div>
							<h5 onclick="toggleSection('js-editor')">JS</h5>
							<button class="copy-btn" onclick="copyToClipboard('js-editor')">
								<span>Copy </span><i class="fa-regular fa-clipboard"></i>
							</button>
						</div>
						<div id="js-editor" class="code-editor"></div>
					</div>
				</div>
			</div>
			<div class="gutter"></div>
			<div class="preview-container" id="preview-container">
				<iframe id="preview" class="preview-iframe"></iframe>
			</div>
		</section>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/codemirror.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/mode/htmlmixed/htmlmixed.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/mode/css/css.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/mode/javascript/javascript.min.js"></script>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/split.js/1.6.5/split.min.js"></script>

		<script>
			const htmlEditor = CodeMirror(document.getElementById("html-editor"), {
				lineNumbers: true,
				mode: "htmlmixed",
				theme: "material-darker",
				value: "<h1>Hello World!</h1>\n<p>Start coding...</p>",
			});

			const cssEditor = CodeMirror(document.getElementById("css-editor"), {
				lineNumbers: true,
				mode: "css",
				theme: "material-darker",
				value: "body {\n  background: #f0f0f0;\n}",
			});

			const jsEditor = CodeMirror(document.getElementById("js-editor"), {
				lineNumbers: true,
				mode: "javascript",
				theme: "material-darker",
				value: 'console.log("Hello from JS!");',
			});

			const editors = {
				"html-editor": htmlEditor,
				"css-editor": cssEditor,
				"js-editor": jsEditor,
			};

			function updatePreview() {
				const html = htmlEditor.getValue();
				const css = `<style>${cssEditor.getValue()}</style>`;
				const js = `<script>${jsEditor.getValue()}<\/script>`;
				document.getElementById("preview").srcdoc = `${css}${html}${js}`;
			}

			htmlEditor.on("change", updatePreview);
			cssEditor.on("change", updatePreview);
			jsEditor.on("change", updatePreview);
			updatePreview();

			Split(["#editor-container", "#preview-container"], {
				sizes: [30, 70],
				minSize: [300, 300],
				gutterSize: 5,
				cursor: "ew-resize",
				onDragEnd: function () {
					htmlEditor.refresh();
					cssEditor.refresh();
					jsEditor.refresh();
				},
			});

			function toggleSection(id) {
				const section = document.getElementById(id);
				section.parentElement.classList.toggle("active");
			}

			function copyToClipboard(editorId) {
				const editor =
					editorId === "html-editor" ? htmlEditor : editorId === "css-editor" ? cssEditor : jsEditor;
				navigator.clipboard
					.writeText(editor.getValue())
					.then(() => {
						alert("Code copied to clipboard!");
					})
					.catch((err) => {
						console.error("Failed to copy: ", err);
					});
			}

			window.addEventListener("DOMContentLoaded", () => {
				const urlParams = new URLSearchParams(window.location.search);
				const componentFile = urlParams.get("component");

				if (!componentFile) {
					console.error("Component file is not specified in the URL.");
					return;
				}

				const filePath = "components/" + componentFile;

				let componentCode;

				fetch(filePath)
					.then((response) => {
						if (!response.ok) throw new Error(`Failed to load ${componentFile}`);
						return response.text();
					})
					.then((result) => {
						componentCode = JSON.parse(result);
						const extractedCSS = componentCode.style;
						const extractedJS = componentCode.script;
						const extractedHtml = componentCode.html;

						htmlEditor.setValue(extractedHtml || "<!-- No HTML content -->");
						cssEditor.setValue(extractedCSS || "/* No CSS found */");
						jsEditor.setValue(extractedJS || "// No JavaScript found");

						updatePreview();
					})
					.catch((error) => {
						console.error("Error loading component:", error);
						htmlEditor.setValue(`Error: ${error.message}`);
						cssEditor.setValue("/* Failed to load CSS */");
						jsEditor.setValue("// Failed to load JavaScript");
					});
			});
		</script>

		<script></script>
	</body>
</html>
